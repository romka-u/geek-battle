<html>
    <head>
        <title>
            Task viewer
        </title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script src="http://hidden-wildwood-8127.herokuapp.com/socket.io/socket.io.js"></script>
        <script type="text/javascript">

        function getTask() {
            var level = $(this).data('level');
            var taskType = $('#tasks').val();
            $.getJSON('task', {type: taskType, level: level}, showTask);
        }

        function showTask(task) {
            if (task == null) {
                $('#question').attr('src', 'http://260days.ca/wp-content/uploads/2011/03/done.gif');
                for (var i = 0; i < 4; i++)
                    $('#choice_' + i).addClass('hide');
                return;
            }

            $(document.body).removeClass('first');
            var url = 'http://geekbeta-nbeloglazov.dotcloud.com/image?id=' + task.id;
            $('#question').attr('src', url + '&type=question');
            $('.correct').removeClass('correct');
            $('.incorrect').removeClass('incorrect');
            for (var i = 0; i < 4; i++) {
                $('#choice_' + i).attr('src', url + '&type=choice&number=' + i);
                $('#choice_' + i).addClass(i === task.correct ? 'correct' : 'incorrect');
            }
            $('.hide').removeClass('hide');
        }

        function showTasksSelection(tasks) {
            var options = $('#tasks')[0].options;
            $.each(tasks, function() {
                var option = new Option(this.name, this.type);
                options[options.length] = option;
            });
        }

        $(function() {
            // $.getJSON('/tasks', showTasksSelection);
            $('#next').on('click', function() {
                socket.emit('get task');
            });
            $('#newgame').on('click', function() {
                $('#status').html('Loading...');
                socket.emit('new game');
            });
        });

        </script>

        <script>
          socket = io.connect();
          socket.on('show task', showTask);
              
              socket.on('game loaded', function() {
            $('#status').html('Loaded.');
          });
        </script>

        <style type="text/css">
        body {
            text-align: center;
            padding-top: 20px;
        }
        img {
            padding: 10px;
            border: #FFF 4px solid;
        }
        div {
            margin: 10px;
        }

        .hide {
            display: none;
        }

        .first img {
            display: none;
        }

        .correct:hover {
            border: #0F0 solid 4px;
        }

        .incorrect:hover {
            border: #F00 solid 4px;
        }
        </style>
    </head>
    
    <body class="first">
        <div>
        <button id="newgame">New game</button>
        <button id="next">Next</button>
        </div>
        <span id="status">Status</span>
        <br>
        <img id="question"></img>
        <br/>
        <img id="choice_0"></img>
        <img id="choice_1"></img>
        <br/>
        <img id="choice_2"></img>
        <img id="choice_3"></img>
    </body>
</html>

